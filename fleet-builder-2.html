<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fleet Builder</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
    <style>
        .right-panel {
            position: fixed;
            right: 20px;
            top: 20px;
            transform: none;
            width: 220px;
            max-width: calc(100% - 24px);
            max-height: calc(100vh - 24px);
            overflow: auto;
            background: rgba(181, 187, 214, 0.98);
            border: 1px solid rgba(0,0,0,0.06);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
            padding: 12px;
            box-sizing: border-box;
            z-index: 99999;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            border-radius: 8px;
        }

        .right-panel h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
        }

        .panel-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .panel-btn {
            display: block;
            width: 100%;
            background: linear-gradient(180deg,#f7f7f7,#efefef);
            border: 1px solid #d0d0d0;
            padding: 8px 10px;
            text-align: left;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }

        .panel-btn.small { padding: 6px 8px; font-size: 12px; }

        .panel-divider { height: 1px; background: #e9e9e9; margin: 8px 0; }

        @media (max-width: 520px) {
            .right-panel { display: none; }
        }
        /* Page template styles (8.5 x 11 aspect ratio) */
        .page {
            width: 720px; /* default visible width for a page when added */
            max-width: 100%;
            aspect-ratio: 8.5 / 11;
            background: #fff;
            border: 1px solid #e0e0e0;
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
            border-radius: 4px;
            margin: 16px;
            position: relative; /* allow absolute-positioned controls inside */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            overflow:hidden;
            user-select:none;
        }

        /* Print styles: format pages as letter-sized sheets for PDF */
        @media print {
            @page { size: Letter; margin: 0.5in; }
            html, body { height: auto; }
            body * { visibility: hidden; }
            main, main * { visibility: visible; }
            .right-panel, #palette { display: none !important; }
            .page {
                width: 8.5in !important;
                height: 11in !important;
                max-width: none !important;
                aspect-ratio: auto !important;
                box-shadow: none !important;
                border: 0px !important;
                margin: 0 auto 0.5in auto !important;
                page-break-after: always;
                page-break-inside: avoid;
            }
            .page .remove-btn, .page .template-btns { display: none !important; }
        }

        .page-content {
            padding: 4.41% 5.38%;
            flex: 1 1 auto;
            color: #222;
            font-size: 14px;
            overflow: hidden;

        }
        /* Remove (delete) button shown per-page */
        .page .remove-btn {
            position: absolute;
            top: 8px;
            right: -40px;
            width: 32px;
            height: 32px;
            padding: 0;
            border-radius: 6px;
            border: 1px solid rgba(0,0,0,0.08);
            background: #ffb3b3;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
            font-size: 14px;
            line-height: 1;
        }
        .page .remove-btn:hover { background: #f47c7c; border-color: rgba(200,0,0,0.2); }
        /* Template-apply buttons that appear under the remove button */
        .page .template-btns {
            position: absolute;
            top: 48px;
            right: -46px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            width: 40px;
        }
        .page .template-btn {
            width: 100%;
            height: 28px;
            border-radius: 6px;
            border: 1px solid rgba(0,0,0,0.08);
            background: #fff;
            cursor: pointer;
            font-size: 11px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 2px;
        }
        .page .template-btn:hover { background: #f0f0ff; }
        .writable {
            flex: 1;
            display: inline-block;
            border: none;
            border-bottom: 3px solid #000;
            background: transparent;
            outline: none;
            padding: 2px 0;
            margin: 0 4px;
            color: #000;
            caret-color: #000;
            box-shadow: none;
            width: auto; /* shrink to fit content */
            min-width: 80px; /* optional: gives a starting size */

            font-family: Impact, 'Arial Narrow', sans-serif;
            letter-spacing: 0.7px;
            font-size:20px;
            position:relative;
            bottom:3px;
            padding-left:20px;
            font-weight:normal;
            color:#5f5f5f;
        }
        .line{
            display: flex;
            align-items: baseline;

        }
        .writable:focus {
            outline: none;
            border-bottom-color: #000;
        }
        .thick-font{
            font-family: Impact, 'Arial Narrow Bold', sans-serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.7px;
        }
        .thin-font{
            font-family: 'Roboto Condensed', Arial, sans-serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.7px;
        }
        .medium-size{
            font-size:20px;
        }
        .drag-panel{
            position:fixed;
            right:0px;
            bottom:0px;
            height:calc(100vh - 300px);
            width:calc(100vw - 950px);
            background:#ffffff;
            border-top-left-radius:50px;
            box-shadow: -6px -6px 6px rgba(0,0,0,0.06);
            padding:50px;
            overflow:scroll;
        }
        body{
            background: rgb(172, 216, 255);
        }
        .hull{
            width:100%;
            user-select:none;
        }
        .collapsible .content {
            display: block; /* visible by default */
        }

        .collapsible.collapsed .content {
            display: none; /* hidden when collapsed */
        }
        .collapsible.collapsed .header::after{
            content: "*";
        }
        .header{
            user-select: none;
        }
        .clone {
            position: fixed; /* fixed so scrolling doesn‚Äôt break it */
            pointer-events: none; /* so it doesn‚Äôt block mouse events */
            opacity: 0.8;
            z-index: 9999;
            width:20%;
            height:20%;
            transform:translate(-50%,-50%);
        }
        .socket{
            flex:1;
        }
        .socket img{
            margin:0 auto;
            display:block;
        }
        .ship-socket-cont{
            display:flex;
            height:100%;
            gap:20px;
            flex-direction: column;
        }
        .placed-hull{
            width:85%;
        }
    </style>
</head>
<body>
    <main id="app" role="main">

    </main>

    <!-- Hidden template for an 8.5x11 page (not displayed until cloned) -->
    <template id="page-template">
        <article class="page" role="article" aria-label="8.5 by 11 inch page">
            <button type="button" class="remove-btn" aria-label="Remove page">‚úñ</button>
            <div class="template-btns" role="group" aria-label="Apply templates">
                <button type="button" class="template-btn" data-template="title" title="Apply Title Page">Title</button>
                <button type="button" class="template-btn" data-template="ships" title="Apply Ship Page">Ships</button>
            </div>
            <div class="page-content"></div>
        </article>
    </template>

    <!-- Page-content templates (placeholders you can edit manually) -->
    <template id="content-template-title">
        <div class="line">
            <h1 class="thick-font">Fleet Name:</h1><input type="text" class="writable" placeholder="Fleet Name">
        </div>
        <div class="line">
            <div class="thick-font medium-size">Faction:</div><input type="text" class="writable" placeholder="Faction">
            <div class="thick-font medium-size">RP:&ensp;</div>
            <div class="thin-font medium-size">0</div>
        </div>
        <br><hr>
        <div class="line">
            <div class="thick-font medium-size">Ships:</div>
        </div>
    </template>

    <template id="content-template-ships">
        <div class="ship-socket-cont">
            <div class="socket"></div>
            <div class="socket"></div>
        </div>
    </template>

    <!-- Right-side button panel (template buttons) -->
    <aside class="right-panel" aria-label="Template actions">
        <h4>Quick Menu</h4>
        <div class="panel-group">
            <button class="panel-btn" id="btn-add-page">üìÑ Add Page</button>
            <!-- <button class="panel-btn" id="btn-load-template">üìÇ Load Template</button> -->
            <!-- <button class="panel-btn" id="btn-save">üíæ Save Fleet</button> -->
            <button class="panel-btn" id="btn-print">üñ®Ô∏è Print</button>
            <!-- <button class="panel-btn" id="btn-clear">üóëÔ∏è Clear</button> -->
        </div>
    </aside>

    <aside class="drag-panel">
        <div class="collapsible">
            <h1 class="thick-font header">Hulls</h1><hr>
            <div id="hulls-cont" class="content">

            </div>
        </div>
        <div class="collapsible">
            <h1 class="thick-font header">Weapons</h1><hr>
            <div id="weapons-cont" class="content">
                
            </div>
        </div>
        <div class="collapsible">
            <h1 class="thick-font header">Equipment</h1><hr>
            <div id="equipment-cont" class="content">
                
            </div>
        </div>
    </aside>

    <script>
        function startdrag(e, elem) {
            e.preventDefault();

            // Clone the element
            const clone = elem.cloneNode(true);
            clone.classList.add("clone");

            // Remove any existing handlers from the clone
            clone.removeAttribute("onmousedown");

            document.body.appendChild(clone);

            // Position updater
            function moveAt(pageX, pageY) {
                clone.style.left = pageX + "px";
                clone.style.top = pageY + "px";
            }

            // Initial position
            moveAt(e.clientX, e.clientY);

            // Mouse move handler
            function onMouseMove(ev) {
                moveAt(ev.clientX, ev.clientY);
            }

            document.addEventListener("mousemove", onMouseMove);

            // Mouse up handler for the clone
            document.onmouseup = function(ev) {
                const elementsUnderCursor = document.elementsFromPoint(ev.clientX, ev.clientY);
                const socket = elementsUnderCursor.find(el => el.classList && el.classList.contains("socket"));
                if (socket) {
                    const data = clone.getAttribute("data-JSON");
                    const hull = document.createElement("img");
                    hull.setAttribute("src",clone.getAttribute("src"));
                    hull.setAttribute("data-JSON",data);
                    hull.setAttribute("draggable","false");
                    hull.classList.add("placed-hull");
                    socket.innerHTML="";
                    socket.appendChild(hull);

                    let hull_sockets = [];
                    for(s of JSON.parse(data)["sockets"]){
                        hull_sockets.push(s);
                    }
                }

                // Cleanup
                document.removeEventListener("mousemove", onMouseMove);
                clone.remove();
                document.onmouseup = undefined;
            };
        }

        const ROW1 = 106;
        const ROW2 = 160;
        const ROW3 = 220;
        const ROW4 = 279;
        const LEFT_SHORT = 101;
        const CENTER_SHORT = 271;
        const RIGHT_SHORT = 446;
        const LEFT_LONG = 128;
        const RIGHT_LONG = 441;
        const LEFT_SHORTOFFSET_LONG = 301;
        const LEFT_LONGOFFSET_LONG = 336;
        const RIGHT_LONGOFFSET_SHORT = 216;

        document.addEventListener('DOMContentLoaded', () => {
            // Add one page on initial load for the title
            addPage();
            // Add a second page for ships
            addPage();


            let hulls = [
                {"filepath":"hulls/fighter.png",        "RP":10,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":2,"position":{"x":LEFT_SHORT,"y":ROW2}}
                ]},
                {"filepath":"hulls/bomber.png",         "RP":12,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW2}}
                ]},
                {"filepath":"hulls/transport.png",      "RP":16,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW2}}
                ]},
                {"filepath":"hulls/interceptor.png",    "RP":12,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":4,"position":{"x":RIGHT_SHORT,"y":ROW2}}
                ]},
                {"filepath":"hulls/freighter.png",      "RP":25,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":2,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":2,"position":{"x":LEFT_SHORTOFFSET_LONG,"y":ROW2}}
                ]},
                {"filepath":"hulls/destroyer.png",      "RP":45,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":2,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW2}}
                ]},
                {"filepath":"hulls/frigate.png",       "RP":40,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":RIGHT_LONG,"y":ROW3}}
                ]},
                {"filepath":"hulls/light_cruiser.png",  "RP":60,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":2,"position":{"x":CENTER_SHORT,"y":ROW2}},
                    {"number":2,"position":{"x":RIGHT_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":LEFT_LONG,"y":ROW3}},
                    {"number":1,"position":{"x":LEFT_LONGOFFSET_LONG,"y":ROW3}}
                ]},
                {"filepath":"hulls/assault_carrier.png","RP":50,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":2,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":LEFT_SHORTOFFSET_LONG,"y":ROW2}},
                    {"number":3,"position":{"x":LEFT_SHORT,"y":ROW3}},
                    {"number":1,"position":{"x":LEFT_SHORTOFFSET_LONG,"y":ROW3}}
                ]},
                {"filepath":"hulls/heavy_cruiser.png",  "RP":75,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":2,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW2}},
                    {"number":2,"position":{"x":LEFT_SHORT,"y":ROW3}},
                    {"number":1,"position":{"x":LEFT_SHORTOFFSET_LONG,"y":ROW3}},
                    {"number":1,"position":{"x":LEFT_LONG,"y":ROW4}}
                ]},
                {"filepath":"hulls/carrier.png",        "RP":70,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":2,"position":{"x":LEFT_SHORTOFFSET_LONG,"y":ROW2}},
                    {"number":4,"position":{"x":LEFT_SHORT,"y":ROW3}},
                    {"number":2,"position":{"x":LEFT_SHORTOFFSET_LONG,"y":ROW3}}
                ]},
                {"filepath":"hulls/battleship.png",     "RP":90,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":4,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":2,"position":{"x":CENTER_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW2}},
                    {"number":2,"position":{"x":LEFT_SHORT,"y":ROW3}},
                    {"number":2,"position":{"x":LEFT_SHORTOFFSET_LONG,"y":ROW3}},
                    {"number":1,"position":{"x":LEFT_LONG,"y":ROW4}}
                ]},
                {"filepath":"hulls/weapon_platform.png","RP":80,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":2,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":2,"position":{"x":LEFT_SHORTOFFSET_LONG,"y":ROW2}},
                    {"number":2,"position":{"x":LEFT_SHORT,"y":ROW3}}
                ]},
                {"filepath":"hulls/command_ship.png",   "RP":120,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":2,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW2}},
                    {"number":2,"position":{"x":RIGHT_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":LEFT_LONG,"y":ROW3}},
                    {"number":2,"position":{"x":LEFT_LONGOFFSET_LONG,"y":ROW3}}
                ]},
                {"filepath":"hulls/dreadnought.png",    "RP":150,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":4,"position":{"x":LEFT_SHORT,"y":ROW2}},
                    {"number":2,"position":{"x":CENTER_SHORT,"y":ROW2}},
                    {"number":4,"position":{"x":RIGHT_SHORT,"y":ROW2}},
                    {"number":1,"position":{"x":RIGHT_LONG,"y":ROW3}},
                    {"number":2,"position":{"x":RIGHT_LONGOFFSET_SHORT,"y":ROW3}},
                    {"number":1,"position":{"x":RIGHT_LONG,"y":ROW4}}

                ]},
                {"filepath":"hulls/station.png",        "RP":100,"sockets":[
                    {"number":1,"position":{"x":LEFT_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":CENTER_SHORT,"y":ROW1}},
                    {"number":1,"position":{"x":RIGHT_SHORT,"y":ROW1}},
                    {"number":2,"position":{"x":RIGHT_LONG,"y":ROW2}},
                    {"number":3,"position":{"x":RIGHT_LONGOFFSET_SHORT,"y":ROW2}},
                    {"number":4,"position":{"x":RIGHT_LONG,"y":ROW3}},
                    {"number":2,"position":{"x":RIGHT_LONGOFFSET_SHORT,"y":ROW3}},
                ]},
            ];


            const hulls_cont = document.getElementById("hulls-cont");
            for(const hull_data of hulls){
                const hull = document.createElement("img");
                hull.setAttribute("src",hull_data["filepath"]);
                hull.setAttribute("data-JSON",JSON.stringify(hull_data));
                hull.classList.add("hull");
                hull.classList.add("draggable");
                hull.setAttribute("onmousedown",'startdrag(event,this)');
                hulls_cont.appendChild(hull);
            }
            
            document.querySelectorAll('.collapsible .header').forEach(header => {
                header.addEventListener('click', () => {
                    header.parentElement.classList.toggle('collapsed');
                });
            });
        });

        (function attachPanelHandlers(){

            const addPageBtn = document.getElementById('btn-add-page');
            const loadTemplate = document.getElementById('btn-load-template');
            const saveFleet = document.getElementById('btn-save');
            const clearFleet = document.getElementById('btn-clear');

            // addPage function ‚Äî clones the hidden template and appends it to #app
            // If templateName is not provided, the function will apply 'title' for the
            // very first page and 'ships' for any subsequent pages (per request).
            function addPage(templateName){
                const tpl = document.getElementById('page-template');
                if(!tpl){
                    return null;
                }

                const main = document.getElementById('app') || document.body;
                // Decide default template when none provided: first page = title, others = ships
                const existingPages = main.querySelectorAll('.page').length;
                if(!templateName){
                    templateName = existingPages === 0 ? 'title' : 'ships';
                }

                const fragment = tpl.content.cloneNode(true);
                // Extract the page element from the fragment so we can attach handlers
                const pageEl = fragment.querySelector('.page') || fragment.firstElementChild;
                if(!pageEl){
                    return null;
                }

                // Append the page element (this removes it from the fragment)
                main.appendChild(pageEl);

                // Attach remove handler to the per-page remove button
                const removeBtn = pageEl.querySelector('.remove-btn');
                if(removeBtn){
                    removeBtn.addEventListener('click', ()=>{
                        pageEl.remove();
                    });
                }

                // Wire up per-page template-apply buttons to replace .page-content.innerHTML
                const contentTemplateMap = {
                    title: document.getElementById('content-template-title'),
                    ships: document.getElementById('content-template-ships')
                };

                // Auto-apply the chosen template (if available)
                const autoTpl = contentTemplateMap[templateName];
                const contentEl = pageEl.querySelector('.page-content');
                if(autoTpl && contentEl){
                    contentEl.innerHTML = autoTpl.innerHTML;
                }

                const tplButtons = pageEl.querySelectorAll('.template-btn[data-template]');
                tplButtons.forEach(btn => {
                    btn.addEventListener('click', ()=>{
                        const name = btn.getAttribute('data-template');
                        const tpl = contentTemplateMap[name];
                        const contentElInner = pageEl.querySelector('.page-content');
                        if(tpl && contentElInner){
                            // Simple replacement of the innerHTML as requested
                            contentElInner.innerHTML = tpl.innerHTML;
                        }
                    });
                });

                return pageEl;
            }

            // Expose addPage globally so DOMContentLoaded handler can call it
            window.addPage = addPage;

            if(addPageBtn) addPageBtn.addEventListener('click', ()=>{
                addPage();
            });


            if(loadTemplate) loadTemplate.addEventListener('click', ()=>{
                alert('Open load template dialog (hook into your UI)');
            });

            if(saveFleet) saveFleet.addEventListener('click', ()=>{
                alert('Save fleet (hook into save function)');
            });

            if(clearFleet) clearFleet.addEventListener('click', ()=>{
                if(confirm('Clear the current fleet?')){
                    // Example: call a clearFleet() function if present
                    // if (typeof clearFleet === 'function') clearFleet();
                    alert('Fleet cleared (placeholder)');
                }
            });

            // Print handler: open print dialog (user can select Save as PDF)
            const printBtn = document.getElementById('btn-print');
            if(printBtn){
                printBtn.addEventListener('click', ()=>{
                    // you could prepare pages or run cleanup here before printing
                    window.print();
                });
            }
        })();

    </script>
</body>
</html>